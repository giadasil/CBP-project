import MDAnalysis as mda
from MDAnalysis.analysis import rms, align
import matplotlib.pyplot as plt
import numpy as np

# 1. Load Universes
u_wt = mda.Universe("wt_protein_only.gro", "wt_protein_only.xtc")
u_af = mda.Universe("af_protein_only.gro", "Alpha_protein_only.xtc")
u_ch = mda.Universe("chimera_protein_only.gro", "chimera_protein_only.xtc")

# Define the reference: Wild Type frame 0 is our crystal structure
# We select CA atoms
ref_selection = "name CA"
reference = u_wt.atoms.select_atoms(ref_selection)

# 2. Align trajectories to the WT reference
# This removes global translation and rotation relative to the crystal structure
for u in [u_wt, u_af, u_ch]:
    print(f"Aligning {u} to Wild Type crystal structure...")
    align.AlignTraj(u, u_wt, select=ref_selection, in_memory=True).run()

# 3. Setup RMSD analysis (all against WT reference)
# Now we calculate RMSD of each system against the WT CA atoms
R_wt = rms.RMSD(u_wt, u_wt, select=ref_selection, ref_frame=0).run()
R_af = rms.RMSD(u_af, u_wt, select=ref_selection, ref_frame=0).run()
R_ch = rms.RMSD(u_ch, u_wt, select=ref_selection, ref_frame=0).run()

# 4. Plotting
plt.figure(figsize=(12, 6))
time_ns = R_wt.results.rmsd[:, 1] / 1000 # Convert ps to ns

plt.plot(time_ns, R_wt.results.rmsd[:, 2], label="Wild Type vs Crystal", color='blue', alpha=0.7)
plt.plot(time_ns, R_af.results.rmsd[:, 2], label="AlphaFold vs WT Crystal", color='green', alpha=0.7)
plt.plot(time_ns, R_ch.results.rmsd[:, 2], label="Chimera vs WT Crystal", color='red', alpha=0.7)

plt.xlabel("Time (ns)", fontsize=12)
plt.ylabel("RMSD (Ã…)", fontsize=12)
plt.title("RMSD", fontsize=14)
plt.legend()
plt.grid(True, linestyle='--', alpha=0.6)
plt.show()
