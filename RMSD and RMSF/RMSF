import MDAnalysis as mda
from MDAnalysis.analysis import rms, align
import matplotlib.pyplot as plt

# 1. Load Universes
u_wt = mda.Universe("wt_protein_only.gro", "wt_protein_only.xtc")
u_af = mda.Universe("af_protein_only.gro", "Alpha_protein_only.xtc")
u_ch = mda.Universe("chimera_protein_only.gro", "chimera_protein_only.xtc")

# Define the reference WT crystal structure (frame 0)
ref_selection = "name CA"
u_wt.trajectory[0] 

# 2. RMSF analysis function
def get_rmsf_aligned_to_wt(u, reference_u):
    print(f"Aligning {u} to WT reference...")
    align.AlignTraj(u, reference_u, select=ref_selection, in_memory=True).run()
    
    # Calculate RMSF of the CA atoms
    # This measures fluctuation around the average position after alignment
    rmsf = rms.RMSF(u.select_atoms("name CA")).run()
    return rmsf.results.rmsf

# Run calculations using the WT universe as the fixed reference
rmsf_wt = get_rmsf_aligned_to_wt(u_wt, u_wt)
rmsf_af = get_rmsf_aligned_to_wt(u_af, u_wt)
rmsf_ch = get_rmsf_aligned_to_wt(u_ch, u_wt)

# 3. Plotting
plt.figure(figsize=(12, 5))
resids = u_wt.residues.resids

plt.plot(resids, rmsf_wt, label="Wild Type", color='blue', alpha=0.7)
plt.plot(resids, rmsf_af, label="AlphaFold Mutant", color='green', alpha=0.7)
plt.plot(resids, rmsf_ch, label="Chimera Mutant", color='red', alpha=0.7)

# Highlight mutation residue 104
plt.axvline(x=104, color='black', linestyle='--', alpha=0.5, label="Mutation 104")

plt.xlabel("Residue ID")
plt.ylabel("RMSF (Ã…)")
plt.title("RMSF")
plt.legend()
plt.grid(True, alpha=0.3)
plt.show()
